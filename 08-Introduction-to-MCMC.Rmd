---
editor_options: 
  chunk_output_type: console
---

[//]: # https://www.youtube.com/watch?v=1qeXD4NQ4To

# Введение в Марковские цепи Монте-Карло

```{r setup08, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(tidyverse)
theme_set(theme_bw())
```

```{r}
library(tidyverse)
```

Марковская цепь Монте-Карло (Markov chain Monte Carlo, MCMC) --- это класс алгоритмов для семплирования, которые позволяют моделировать некоторое распределение вероятностей. При моделировании используют разные алгоритмы, мы будем смотреть на примере алгоритма Метрополиса-Гастингса (Metropolis-Hastings).

Для того, чтобы в этом разобраться нам потребуется обсудить:

* метод Монте-Карло;
* марковские цепи;
* алгоритма Метрополиса-Гастингса.

## Метод Монте-Карло


## Марковские цепи

Марковский процесс

* конечное количество состояний
* вероятность переходов из одного состояния в другое

Возьмем наш датасет с sms и посмотрим частоты разных частей речи::

```{r, echo=FALSE}
sms_pos <- read_csv("https://raw.githubusercontent.com/agricolamz/2022_da4l/master/data/spam_sms_pos_lead_pos.csv")
library(tidytext)
sms_pos %>% 
  count(pos, type) %>% 
  mutate(pos = reorder_within(pos, n, type)) %>% 
  ggplot(aes(n, pos))+
  geom_col(fill = "lightblue")+
  facet_wrap(~type, scales = "free")+
  scale_y_reordered()+
  labs(title = "Частотность разных частей речи в sms сообщениях",
       x = "", y = "",
       caption = "kaggle.com/uciml/sms-spam-collection-dataset")
```

Теперь давайте посмотрим на частотность переходов из одних состояний в другие:

```{r}
sms_pos %>% 
  na.omit() %>% 
  count(type, pos, pos2) %>% 
  group_by(type) %>% 
  mutate(ratio = n/sum(n)) %>% 
  ggplot(aes(pos, pos2, size = Freq, fill = Freq))+
  geom_raster()+
  geom_point()+
  scale_fill_gradient(low="grey95", high="red")
```


[Славная визуализация](http://setosa.io/blog/2014/07/26/markov-chains/index.html) (спасибо за ссылку Марине Дубовой).

## Соединим идеи Марковских цепей и Монте-Карло

```{r, eval=FALSE}
shiny::runGitHub("agricolamz/mcmc_shiny")
```

## Алгоритма Метрополиса-Гастингса

## `brms`
